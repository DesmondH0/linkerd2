#!/bin/bash

bindir=$( cd "${BASH_SOURCE[0]%/*}" && pwd )

# shellcheck source=_test-helpers.sh
. "$bindir"/_test-helpers.sh
test_setup "$@"

name="deep"
if [ -z "$skip_kind_create" ]; then
    create_cluster "$name" "default"
    "$bindir"/kind-load ${images:+'--images'} ${images_host:+'--images-host' "$images_host"} "$name"
fi
check_cluster "$name"
run_test "$test_directory/install_test.go"
while IFS= read -r line; do tests+=("$line"); done <<< "$(go list "$test_directory"/.../...)"
run_test "${tests[@]}"
delete_cluster "$name"
