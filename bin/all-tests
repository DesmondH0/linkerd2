#!/bin/bash

# This script executes the full suite of integration tests, in series:
# 1. upgrade-tests
# 2. helm-tests
# 3. helm-upgrade-tests
# 4. uninstall-tests
# 5. deep-tests
# 6. external-issuer-tests

bindir=$( cd "${BASH_SOURCE[0]%/*}" && pwd )

# shellcheck source=_test-helpers.sh
. "$bindir"/_test-helpers.sh
handle_input "$@"

printf '==================RUNNING ALL TESTS==================\n'

"$bindir"/upgrade-tests "$@"
"$bindir"/helm-tests "$@"
"$bindir"/helm-upgrade-tests "$@"
"$bindir"/uninstall-tests "$@"
"$bindir"/deep-tests "$@"
"$bindir"/external-issuer-tests "$@"

if [ $exit_code -eq 0 ]; then
    printf '\n=== PASS: all tests passed\n'
else
    printf '\n=== FAIL: at least one test failed\n'
fi

exit $exit_code
